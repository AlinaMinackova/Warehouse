<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head}"></head>
<body>

<!-- Навбар -->
<div th:replace="~{fragments/header :: body}"></div>

<div class="container mt-4">
    <h2 class="text-center mb-4">СКЛАДСКИЕ ЗАПАСЫ</h2>

    <div class="text-center mt-5 mb-5">
        <a th:href="@{/stock/add}"
           class="btn-submit text-decoration-none">
            Добавить поступление
        </a>
    </div>


    <!-- Форма фильтрации -->
    <form method="get" th:action="@{/stock/findAll}" class="d-flex mb-4">
        <!-- Склад -->
        <select name="warehouseId" class="form-select me-2">
            <option value="" th:selected="${selectedWarehouse == null}">Все склады</option>
            <option th:each="w : ${warehouses}"
                    th:value="${w.id}"
                    th:text="${w.name}"
                    th:selected="${selectedWarehouse != null and selectedWarehouse == w.id}">
            </option>
        </select>

        <!-- Продукт -->
        <select name="productId" class="form-select me-2">
            <option value="" th:selected="${selectedProduct == null}">Все продукты</option>
            <option th:each="p : ${products}"
                    th:value="${p.id}"
                    th:text="${p.name}"
                    th:selected="${selectedProduct != null and selectedProduct == p.id}">
            </option>
        </select>

        <select name="sort" class="form-select me-2">
            <option value="desc" th:selected="${selectedSort == 'desc'}">Сначала новые</option>
            <option value="asc" th:selected="${selectedSort == 'asc'}">Сначала старые</option>
        </select>

        <button type="submit" class="btn btn-secondary">НАЙТИ</button>
    </form>

    <div class="row">
        <p><b>Приходов на склады:</b> <span th:text="${size}">10</span></p>
    </div>

    <div class="row">
        <div class="col-md-3 mb-4" th:each="stock : ${stocks}">
            <div class="card card-custom p-3 h-100">

                <!-- Изображение продукта -->
                <img th:if="${stock.product.imageUrl != null}"
                     th:src="${stock.product.imageUrl}"
                     alt="Продукт"
                     class="mb-3"
                     style="max-height: 120px; object-fit: contain; border-radius: 5px;">

                <!-- Название продукта -->
                <p><b>Название:</b> <span th:text="${stock.product.name}">Продукт</span></p>

                <!-- Склад -->
                <p><b>Склад:</b> <span th:text="${stock.warehouse.name}">Склад</span></p>

                <!-- Количество -->
                <p><b>Количество:</b> <span th:text="${stock.quantity}">0</span></p>

                <!-- Дата прихода -->
                <p><b>Дата прихода:</b> <span th:text="${#temporals.format(stock.arrivalDate, 'dd.MM.yyyy HH:mm')}">2025-02-25</span></p>

                <!-- Кладовщик -->
                <p><b>Принял:</b>
                    <span th:text="${stock.storekeeper.lastName + ' '
                                    + stock.storekeeper.firstName
                                    + ' '
                                    + (stock.storekeeper.middleName != null ? stock.storekeeper.middleName : '')}">
                        ФИО
                    </span>
                </p>

                <!-- Действия -->
                <div class="mt-auto">
                    <a th:href="@{/stock/{id}/edit(id=${stock.id})}"
                       class="btn btn-outline-dark btn-sm me-2">РЕДАКТИРОВАТЬ</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Пагинация -->
    <nav th:if="${pag != null and pag.totalPages > 1}" aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-4">

            <!-- Кнопка "назад" -->
            <li th:classappend="${pag.first} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/stock/findAll(page=${pag.number - 1}, size=${pag.size}, warehouseId=${selectedWarehouse}, productId=${selectedProduct}, sort=${selectedSort})}">‹</a>
            </li>

            <!-- Всегда первая страница -->
            <li th:if="${pag.number > 2}">
                <a class="page-link" th:href="@{/stock/findAll(page=0, size=${pag.size}, warehouseId=${selectedWarehouse}, productId=${selectedProduct}, sort=${selectedSort})}">1</a>
            </li>
            <li th:if="${pag.number > 3}">
                <span class="page-link">...</span>
            </li>

            <!-- Страницы вокруг текущей -->
            <li th:each="i : ${#numbers.sequence(pag.number-2 > 0 ? pag.number-2 : 0,
                                             pag.number+2 < pag.totalPages-1 ? pag.number+2 : pag.totalPages-1)}"
                th:classappend="${i == pag.number} ? 'active'">
                <a class="page-link"
                   th:href="@{/stock/findAll(page=${i}, size=${pag.size}, warehouseId=${selectedWarehouse}, productId=${selectedProduct}, sort=${selectedSort})}"
                   th:text="${i+1}"></a>
            </li>

            <!-- Троеточие перед последней страницей -->
            <li th:if="${pag.number < pag.totalPages-4}">
                <span class="page-link">...</span>
            </li>

            <!-- Последняя страница -->
            <li th:if="${pag.number < pag.totalPages-3}">
                <a class="page-link"
                   th:href="@{/stock/findAll(page=${pag.totalPages-1}, size=${pag.size}, warehouseId=${selectedWarehouse}, productId=${selectedProduct}, sort=${selectedSort})}"
                   th:text="${pag.totalPages}"></a>
            </li>

            <!-- Кнопка "вперёд" -->
            <li th:classappend="${pag.last} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/stock/findAll(page=${pag.number + 1}, size=${pag.size}, warehouseId=${selectedWarehouse}, productId=${selectedProduct}, sort=${selectedSort})}">›</a>
            </li>

        </ul>
    </nav>


</div>

<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
