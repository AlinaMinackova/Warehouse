<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head}"></head>
<body>

<!-- üîπ –ù–∞–≤–±–∞—Ä -->
<div th:replace="~{fragments/header :: body}"></div>

<div class="container mt-4">
    <h2 class="text-center mb-4">–°–ö–õ–ê–î–°–ö–ò–ï –ó–ê–ü–ê–°–´</h2>

    <!-- üîπ –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
    <form method="get" th:action="@{/stock/findAll}" class="d-flex mb-4">
        <!-- –°–∫–ª–∞–¥ -->
        <select name="warehouseId" class="form-select me-2">
            <option value="" th:selected="${selectedWarehouse == null}">–í—Å–µ —Å–∫–ª–∞–¥—ã</option>
            <option th:each="w : ${warehouses}"
                    th:value="${w.id}"
                    th:text="${w.name}"
                    th:selected="${selectedWarehouse != null and selectedWarehouse == w.id}">
            </option>
        </select>

        <!-- –ü—Ä–æ–¥—É–∫—Ç -->
        <select name="productId" class="form-select me-2">
            <option value="" th:selected="${selectedProduct == null}">–í—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã</option>
            <option th:each="p : ${products}"
                    th:value="${p.id}"
                    th:text="${p.name}"
                    th:selected="${selectedProduct != null and selectedProduct == p.id}">
            </option>
        </select>

        <select name="sort" class="form-select me-2">
            <option value="desc" th:selected="${selectedSort == 'desc'}">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
            <option value="asc" th:selected="${selectedSort == 'asc'}">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
        </select>

        <button type="submit" class="btn btn-secondary">–ù–ê–ô–¢–ò</button>
    </form>


    <div class="row">
        <div class="col-md-3 mb-4" th:each="stock : ${stocks}">
            <div class="card card-custom p-3 h-100">

                <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ -->
                <img th:if="${stock.product.imageUrl != null}"
                     th:src="${stock.product.imageUrl}"
                     alt="–ü—Ä–æ–¥—É–∫—Ç"
                     class="mb-3"
                     style="max-height: 120px; object-fit: contain; border-radius: 5px;">

                <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ -->
                <p><b>–ù–∞–∑–≤–∞–Ω–∏–µ:</b> <span th:text="${stock.product.name}">–ü—Ä–æ–¥—É–∫—Ç</span></p>

                <!-- –°–∫–ª–∞–¥ -->
                <p><b>–°–∫–ª–∞–¥:</b> <span th:text="${stock.warehouse.name}">–°–∫–ª–∞–¥</span></p>

                <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ -->
                <p><b>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</b> <span th:text="${stock.quantity}">0</span></p>

                <!-- –î–∞—Ç–∞ –ø—Ä–∏—Ö–æ–¥–∞ -->
                <p><b>–î–∞—Ç–∞ –ø—Ä–∏—Ö–æ–¥–∞:</b> <span th:text="${#temporals.format(stock.arrivalDate, 'dd.MM.yyyy HH:mm')}">2025-02-25</span></p>

                <!-- –ö–ª–∞–¥–æ–≤—â–∏–∫ -->
                <p><b>–ü—Ä–∏–Ω—è–ª:</b>
                    <span th:text="${stock.storekeeper.lastName + ' '
                                    + stock.storekeeper.firstName
                                    + ' '
                                    + (stock.storekeeper.middleName != null ? stock.storekeeper.middleName : '')}">
                        –§–ò–û
                    </span>
                </p>

                <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                <div class="mt-auto">
                    <a th:href="@{/stock/{id}/delete(id=${stock.id})}"
                       class="btn btn-outline-secondary btn-sm me-2">–£–î–ê–õ–ò–¢–¨</a>
                    <a th:href="@{/stock/{id}/edit(id=${stock.id})}"
                       class="btn btn-outline-dark btn-sm">–†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨</a>
                </div>
            </div>
        </div>
    </div>

    <!-- üîπ –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <nav th:if="${pag != null and pag.totalPages > 1}" aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-4">

            <!-- –ö–Ω–æ–ø–∫–∞ "–Ω–∞–∑–∞–¥" -->
            <li th:classappend="${pag.first} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/stock/findAll(page=${pag.number - 1}, size=${pag.size})}">‚Äπ</a>
            </li>

            <!-- –í—Å–µ–≥–¥–∞ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
            <li th:if="${pag.number > 2}">
                <a class="page-link" th:href="@{/stock/findAll(page=0, size=${pag.size})}">1</a>
            </li>
            <li th:if="${pag.number > 3}">
                <span class="page-link">...</span>
            </li>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã –≤–æ–∫—Ä—É–≥ —Ç–µ–∫—É—â–µ–π -->
            <li th:each="i : ${#numbers.sequence(pag.number-2 > 0 ? pag.number-2 : 0,
                                             pag.number+2 < pag.totalPages-1 ? pag.number+2 : pag.totalPages-1)}"
                th:classappend="${i == pag.number} ? 'active'">
                <a class="page-link"
                   th:href="@{/stock/findAll(page=${i}, size=${pag.size})}"
                   th:text="${i+1}"></a>
            </li>

            <!-- –¢—Ä–æ–µ—Ç–æ—á–∏–µ –ø–µ—Ä–µ–¥ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π -->
            <li th:if="${pag.number < pag.totalPages-4}">
                <span class="page-link">...</span>
            </li>

            <!-- –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
            <li th:if="${pag.number < pag.totalPages-3}">
                <a class="page-link"
                   th:href="@{/stock/findAll(page=${pag.totalPages-1}, size=${pag.size})}"
                   th:text="${pag.totalPages}"></a>
            </li>

            <!-- –ö–Ω–æ–ø–∫–∞ "–≤–ø–µ—Ä—ë–¥" -->
            <li th:classappend="${pag.last} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/stock/findAll(page=${pag.number + 1}, size=${pag.size})}">‚Ä∫</a>
            </li>

        </ul>
    </nav>


</div>

<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
