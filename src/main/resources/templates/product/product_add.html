<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head}"></head>
<body>
<div th:replace="~{fragments/header :: body}"></div>

<div class="container flex-grow-1 mt-4">
    <h2 class="text-center mb-4">ДОБАВИТЬ ПРОДУКТ</h2>

    <div class="form-container">
        <form th:action="@{/product/add}" th:object="${product}" method="post" enctype="multipart/form-data">

            <div class="mb-3">
                <label class="form-label">Название <span class="text-danger">*</span></label>
                <input type="text" class="form-control" th:field="*{name}"/>
                <div class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
            </div>


            <div class="mb-3">
                <label class="form-label">Производитель <span class="text-danger">*</span></label>
                <select name="manufacturerId" class="form-control" required>
                    <option value="" disabled selected>Выберите производителя</option>
                    <option th:each="m : ${manufacturers}"
                            th:value="${m.id}"
                            th:text="${m.name}"
                            th:selected="${product.manufacturer != null and product.manufacturer.id == m.id}"></option>
                </select>
                <div class="text-danger" th:if="${#fields.hasErrors('manufacturer')}" th:errors="*{manufacturer}"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Категория <span class="text-danger">*</span></label>
                <select name="categoryId" class="form-control" required>
                    <option value="" disabled selected>Выберите категорию</option>
                    <option th:each="c : ${categories}"
                            th:value="${c.id}"
                            th:text="${c.name}"
                            th:selected="${product.category != null and product.category.id == c.id}"></option>
                </select>
                <div class="text-danger" th:if="${#fields.hasErrors('category')}" th:errors="*{category}"></div>
            </div>


            <!-- Фото -->
            <div class="mb-3">
                <label class="form-label fw-semibold">Фото</label>

                <div class="mb-2">
                    <img id="previewImage"
                         src="#"
                         alt="Предпросмотр"
                         class="img-thumbnail"
                         style="max-width: 200px; max-height: 200px; display: none;">
                </div>

                <input class="form-control" type="file" id="imageInput" name="file">
            </div>

            <!-- JS -->
            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    const input = document.getElementById("imageInput");
                    const preview = document.getElementById("previewImage");

                    input.addEventListener("change", () => {
                        const file = input.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = e => {
                                preview.src = e.target.result;
                                preview.style.display = "block"; // показать превью
                            };
                            reader.readAsDataURL(file);
                        } else {
                            preview.src = "#";
                            preview.style.display = "none"; // скрыть если фото убрали
                        }
                    });
                });
            </script>


            <div class="mb-3">
                <label class="form-label">Срок годности (дн.) <span class="text-danger">*</span></label>
                <input type="number" class="form-control" th:field="*{lifeDays}"/>
                <div class="text-danger" th:if="${#fields.hasErrors('lifeDays')}" th:errors="*{lifeDays}"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Вес (кг) <span class="text-danger">*</span></label>
                <input type="number" step="0.01" class="form-control" th:field="*{weight}"/>
                <div class="text-danger" th:if="${#fields.hasErrors('weight')}" th:errors="*{weight}"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Состав</label>
                <textarea class="form-control" th:field="*{composition}"></textarea>
                <div class="text-danger" th:if="${#fields.hasErrors('composition')}" th:errors="*{composition}"></div>
            </div>
            <div class="text-center">
                <button type="submit" class="btn-submit">Сохранить</button>
            </div>
        </form>
    </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
