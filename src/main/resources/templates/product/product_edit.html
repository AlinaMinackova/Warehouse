<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head}"></head>
<body>

<!-- üîπ –ù–∞–≤–±–∞—Ä -->
<div th:replace="~{fragments/header :: body}"></div>

<div class="container flex-grow-1 mt-4">
    <h2 class="text-center mb-4">–†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨ –ü–†–û–î–£–ö–¢</h2>

    <div class="form-container">
        <form th:action="@{/product/{id}/edit(id=${product.id})}" th:object="${product}" method="post" enctype="multipart/form-data">
            <input type="hidden" name="_method" value="put"/>

            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
            <div class="mb-3">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ <span class="text-danger">*</span></label>
                <input type="text" class="form-control" th:field="*{name}"/>
                <div class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
            </div>

            <!-- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å -->
            <div class="mb-3">
                <label class="form-label">–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å <span class="text-danger">*</span></label>
                <select name="manufacturerId" class="form-control" required>
                    <option value="" disabled>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è</option>
                    <option th:each="m : ${manufacturers}"
                            th:value="${m.id}"
                            th:text="${m.name}"
                            th:selected="${product.manufacturer != null and product.manufacturer.id == m.id}">
                    </option>
                </select>
                <div class="text-danger" th:if="${#fields.hasErrors('manufacturer')}" th:errors="*{manufacturer}"></div>
            </div>

            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
            <div class="mb-3">
                <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è <span class="text-danger">*</span></label>
                <select name="categoryId" class="form-control" required>
                    <option value="" disabled>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                    <option th:each="c : ${categories}"
                            th:value="${c.id}"
                            th:text="${c.name}"
                            th:selected="${product.category != null and product.category.id == c.id}">
                    </option>
                </select>
                <div class="text-danger" th:if="${#fields.hasErrors('category')}" th:errors="*{category}"></div>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">–§–æ—Ç–æ</label>

                <!-- –¢–µ–∫—É—â–µ–µ —Ñ–æ—Ç–æ -->
                <div class="mb-2" th:if="${product.imageUrl != null}">
                    <img id="currentImage"
                         th:src="${product.imageUrl}"
                         alt="–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞"
                         class="img-thumbnail"
                         style="max-width: 200px; max-height: 200px;">
                </div>

                <input class="form-control" type="file" id="imageInput" name="file">
            </div>

            <!-- ?? JS –¥–ª—è –∑–∞–º–µ–Ω—ã —Ñ–æ—Ç–æ -->
            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    const input = document.getElementById("imageInput");
                    const currentImage = document.getElementById("currentImage");

                    input.addEventListener("change", () => {
                        const file = input.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = e => {
                                currentImage.src = e.target.result; // –∑–∞–º–µ–Ω—è–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É
                                currentImage.style.display = "block"; // –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Ä–∞–Ω—å—à–µ —Ñ–æ—Ç–æ –Ω–µ –±—ã–ª–æ
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                });
            </script>

            <!-- –°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ -->
            <div class="mb-3">
                <label class="form-label">–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ (–¥–Ω.) <span class="text-danger">*</span></label>
                <input type="number" class="form-control" th:field="*{lifeDays}"/>
                <div class="text-danger" th:if="${#fields.hasErrors('lifeDays')}" th:errors="*{lifeDays}"></div>
            </div>

            <!-- –í–µ—Å -->
            <div class="mb-3">
                <label class="form-label">–í–µ—Å (–∫–≥) <span class="text-danger">*</span></label>
                <input type="number" step="0.01" class="form-control" th:field="*{weight}"/>
                <div class="text-danger" th:if="${#fields.hasErrors('weight')}" th:errors="*{weight}"></div>
            </div>

            <!-- –°–æ—Å—Ç–∞–≤ -->
            <div class="mb-3">
                <label class="form-label">–°–æ—Å—Ç–∞–≤</label>
                <textarea class="form-control" th:field="*{composition}"></textarea>
                <div class="text-danger" th:if="${#fields.hasErrors('composition')}" th:errors="*{composition}"></div>
            </div>

            <div class="text-center">
                <button type="submit" class="btn-submit">–û–±–Ω–æ–≤–∏—Ç—å</button>
<!--                <a th:href="@{/product/{id}/delete(id=${product.id})}"-->
<!--                   class="btn-submit">-->
<!--                    –£–¥–∞–ª–∏—Ç—å-->
<!--                </a>-->
                <button type="button"
                        class="btn-submit"
                        data-bs-toggle="modal"
                        data-bs-target="#confirmDeleteModal"
                        th:data-id="${product.id}"
                        th:data-name="${product.name}">
                    –£–¥–∞–ª–∏—Ç—å
                </button>
            </div>
        </form>
    </div>
</div>


<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
            </div>
            <div class="modal-body">
                –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç <strong id="deleteItemName">...</strong>?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <form id="deleteForm" method="get">
                    <input type="hidden" name="_method" value="delete"/>
                    <button type="submit" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ id -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const deleteModal = document.getElementById("confirmDeleteModal");
        const deleteForm = document.getElementById("deleteForm");
        const deleteItemName = document.getElementById("deleteItemName");

        deleteModal.addEventListener("show.bs.modal", event => {
            const button = event.relatedTarget;
            const id = button.getAttribute("data-id");
            const name = button.getAttribute("data-name");

            // –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
            deleteItemName.textContent = name;

            // –§–æ—Ä–º–∏—Ä—É–µ–º action
            deleteForm.action = "/product/" + id + "/delete";
        });
    });
</script>


<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
